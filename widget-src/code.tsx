const { widget } = figma;
const { AutoLayout, Ellipse, Frame, Image, Rectangle, SVG, Text, useSyncedState, useEffect, waitForTask, useSyncedMap } = widget;
const pluginFrameSize = {
  width: 328,
  height: 263
};

console.clear();
// var usedNode: any[] = []
// var removedNode: any[] = []
var previousStickies: any[] = []
// var username: any[] = []
var avatarColorList = [
  '#14AE5C', '#FFA629', '#F24822', '#9747FF', '#667799', '#FF24BD'
]

const iconChecked = `
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<circle cx="12" cy="12" r="12" fill="#FFA629"/>
<line x1="6.70711" y1="13.2929" x2="9.70711" y2="16.2929" stroke="white" stroke-width="2"/>
<line x1="6.70711" y1="13.2929" x2="9.70711" y2="16.2929" stroke="black" stroke-width="2"/>
<line x1="18.7071" y1="8.70711" x2="9.70711" y2="17.7071" stroke="white" stroke-width="2"/>
<line x1="18.7071" y1="8.70711" x2="9.70711" y2="17.7071" stroke="black" stroke-width="2"/>
</svg>
`

const companyLogo = `
<svg width="88" height="88" viewBox="0 0 88 88" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect width="88" height="88" rx="8" fill="url(#pattern0)"/>
<defs>
<pattern id="pattern0" patternContentUnits="objectBoundingBox" width="1" height="1">
<use xlink:href="#image0_216_277" transform="scale(0.000526316)"/>
</pattern>
<image id="image0_216_277" width="1900" height="1900" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAB2wAAAdsCAYAAABj+nzAAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAFO+SURBVHgB7N09b91nGYDxxy9JXKckDRtI7cBaNtg6IhCMnWCiTDC1nbr1G2RiTLZ2SkIlhkqkUroRh6WZ6nSLB0eKtxpbqmwU2uLTIFGhpPXLsS8n5/eTrL/kT/Douc59P3OPPhhfDwAAAAAAAABO3PwAAAAAAAAAICHYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIA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AAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAA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EMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAAABCBFsAAAAAAACAEMEWAAAAAAAAIESwBQAAAAAAAAgRbAEAAAAAACggQ7AFAAAAAAAACBFsAQAAAAAAAEIEWwAAAAAAAIAQwRYAAAAAAAAgRLAFAAAAAAAACBFsAQAAAAAAAEIEWwAAAAAAAIAQwRYAAAAAAAAgRLAFAAAAAAAACBFsAQAAAAAAAEIEWwAAAAAAAIAQwRYAAAAAAAAgRLAFAAAAAAAACBFsAQAAAAAAAEIEWwAAAAAAAIAQwRYAAAAAAAAgRLAFAAAAAAAACBFsAQAAAAAAAEIEWwAAAAAAAIAQwRYAAAAAAAAgRLAFAAAAAAAACBFsAQAAAAAAAEIEWwAAAAAAAIAQwRYAAAAAAAAgRLAFAAAAAAAACBFsAQAAAAAAAEIEWwAAAAAAAIAQwRYAAAAAAAAgRLAFAAAAAAAACBFsAQAAAAAAAEIEWwAAAAAAAIAQwRYAAAAAAAAgRLAFAAAAAAAACBFsAQAAAAAAAEIEWwAAAAAAAIAQwRYAAAAAAAAgRLAFAAAAAAAACBFsAQAAAAAAAEIEWwAAAAAAAIAQwRYAAAAAAAAgRLAFAAAAAAAACBFsAQAAAAAAAEIEWwAAAAAAAIAQwRYAAAAAAAAgRLAFAAAAAAAACBFsAQAAAAAAAEIEWwAAAAAAAIAQwRYAAAAAAAAgRLAFAAAAAAAACBFsAQAAAAAAAEIEWwAAAAAAAIAQwRYAAAAAAAAgRLAFAAAAAAAACBFsAQAAAAAAAEIEWwAAAAAAAIAQwRYAAAAAAAAgRLAFAAAAAAAACBFsAQAAAAAAAEIEWwAAAAAAAIAQwRYAAAAAAAAgRLAFAAAAAAAACBFsAQAAAAAAAEIEWwAAAAAAAIAQwRYAAAAAAAAgRLAFAAAAAAAACBFsAQAAAAAAAEIEWwAAAAAAAIAQwRYAAAAAAAAgRLAFAAAAAAAACBFsAQAAAAAAAEIEWwAAAAAAAIAQwRYAAAAAAAAgRLAFAAAAAAAACBFsAQoAAAAAACBDsAUAAAAAAAAIEWwBAAAAAAAAQgRbAAAAAAAAgBDBFgAAAAAAACBEsAUAAAAAAAAIEWwBAAAAAAAAQgRbAAAAAAAAgBDBFgAAAAAAACBEsAUAAAAAAAAIEWwBAAAAAAAAQgRbAAAAAAAAgBDBFgAAAAAAACBEsAUAAAAAAAAIEWwBAAAAAAAAQgRbAAAAAAAAgBDBFgAAAAAAACBEsAUAAAAAAAAIEWwBAAAAAAAAQgRbAAAAAAAAgBDBFgAAAAAAACBEsAUAAAAAAAAIEWwBAAAAAAAAQgRbAAAAAAAAgBDBFgAAAAAAACBEsAUAAAAAAAAIEWwBAAAAAAAAQgRbAAAAAAAAgBDBFgAAAAAAACBEsAUAAAAAAAAIEWwBAAAAAAAAQgRbAAAAAAAAgBDBFgAAAAAAACBEsAUAAAAAAAAIEWwBAAAAAAAAQgRbAAAAAAAAgBDBFgAAAAAAACBEsAUAAAAAAAAIEWwBAAAAAAAAQgRbAAAAAAAAgBDBFgAAAAAAACBEsAUAAAAAAAAIEWwBAAAAAAAAQgRbAAAAAAAAgBDBFgAAAAAAACBEsAUAAAAAAAAIEWwBAAAAAAAAQgRbAAAAAAAAgBDBFgAAAAAAACBEsAUAAAAAAAAIEWwBAAAAAAAAQgRbAAAAAAAAgBDBFgAAAAAAACBEsAUAAAAA/r+9+2e2c1wDMP6cOeeYvU9mrNmnS+YkxUlnRyUaScmMZGiJhi4+gU9AR0OpQqUw4wNQotNpKZjRZgSxt/xZvBtDZcRea13Ju36/D/E013PfNwAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgA4tsXOcgBsmrcHAAAAmAPBFgA4tgd37wyATfP2AAAAAHMg2AIAx/bwqVsDYNPO7Am2AAAAwP1PsAUAju1/e7cHwKbt+ywCAAAAzIBgCwAc22lTbsCGLXaXY7Hj7QEAAADuf4ItAHBsF87+OAA26dxJ07UAAADAPAi2AMCxTeFksbMcAJtyaf9wAAAAAMyBYAsArMSlc+IJsDmPnb05AAAAAOZAsAUAVuKx/1uLDGzGmb0749xJwRYAAACYB8EWAFiJSw8dWosMbIR1yAAAAMCcCLYAwEosdpfj2fM/DIB1u3rxxgAAAACYC8EWAFiZy/vWIgPrdeX8wTi9d3sAAAAAzIVgCwCszHTH9sJZdyWB9bnyyMEAAAAAmBPBFgBYqZce/34ArMM0XTt9DAEAAACYE8EWAFipKaZMUQVg1XwIAQAAAOZIsAUAVu7lp74di53lAFiVKda6XQsAAADMkWALAKzcYnc5Xn/m+gBYhTN7d8ZLT5iuBQAAAOZJsAUA1uLy/uG4evHGADiu91+8NgAAAADmSrAFANZmWmF67tStAfB3vfL0d1YhAwAAALMm2AIAazOtRn77+W+O1pkC3K3p04dJfQAAAGDuBFsAYK2mybhpnaloC9yNKda6WwsAAABsA8EWAFg70Ra4G2ItAAAAsE0EWwBgI0Rb4K8QawEAAIBtI9gCABvzW7S9tH84AP5osbMcbzxzXawFAAAAts4/br43lgMAYMNe/fDEePWDEwPg4VO3xlvPf3P0qQMAAABg2wi2AEDmq2v/HC+8sxifff2vAWyfaap2mqi9evHGAAAAANhWgi0AkHv3093x2gcnxpfXXGuAbXHl/MHRvVpTtQAAAMC2E2wBgHvGFG7f/GjXxC3M1DRRe+XRg3H1wg2hFgAAAOBXgi0AcM+Zgu2bH/9nfPL5A6ZuYQYunL05nnzocDx3/mA8uHNnAAAAAPA7wRYAuKdN8fbjLx4Yn3zx76Obt6Zv4d42TdGe/u/to0i7f/LWuLx/KNICAAAA/AnBFgC470zR9vrBL5O3X/4ccYHWmb3bR1F2sbu06hgAAADgLgm2AAAAAAAAABFH4QAAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgIhgCwAAAAAAABARbAEAAAAAAAAigi0AAAAAAABARLAFAAAAAAAAiAi2AAAAAAAAABHBFgAAAAAAACAi2AIAAAAAAABEBFsAAAAAAACAiGALAAAAAAAAEBFsAQAAAAAAACKCLQAAAAAAAEBEsAUAAAAAAACICLYAAAAAAAAAEcEWAAAAAAAAICLYAgAAAAAAAEQEWwAAAAAAAICIYAsAAAAAAAAQEWwBAAAAAAAAIoItAAAAAAAAQESwBQAAAAAAAIgItgAAAAAAAAARwRYAAAAAAAAgItgCAAAAAAAARARbAAAAAAAAgMhPdItAmIaKyrcAAAAASUVORK5CYII="/>
</defs>
</svg>

`

function Widget() {
  // const [usedNode, setUsedNode] = useSyncedState<any>('usedNode', [])
  const usedNode = useSyncedMap<any>("usedNode")
  // const [removedNode, setRemovedNode] = useSyncedState<any>('removedNode', [])
  const removedNode = useSyncedMap<any>("removedNode")
  // const [previousStickies, setPreviousStickies] = useSyncedState<any>('previousStickies', [])
  // const [username, setUsername] = useSyncedState<any>('username', [])
  const username = useSyncedMap<any>("username")
  const collaborators = useSyncedMap<any>("collaborators")
  const status = useSyncedMap<any>("status")
  // const [contributors, setContributors] = useSyncedState<any>('contributors', [])
  // const [reviews, setReviews] = useSyncedState<any>('reviews', []);
  const [clickedItem, setClickedItem] = useSyncedState<any>('clickedItem', null);
  const [isFirst, setFirst] = useSyncedState<any>('isFirst', true)

  const checkSticky = () => {
    var curStickies = figma.currentPage.findChildren((node:any) => node.type === "STICKY" && removedNode.get(node.id) != 1 && node['authorVisible'])
    const curSections = figma.currentPage.findChildren((node:any) => node.type === "SECTION")
    curSections.forEach((section:any) => {
      let sticky = section.findChildren((node:any) => node.type === "STICKY" && removedNode.get(node.id) != 1 && node['authorVisible'])
      if(sticky?.length > 0) curStickies.push(...sticky)
    })
  
    var stickies = figma.currentPage.findChildren((node:any) => node.type === "STICKY" && usedNode.get(node.id) != 1 && removedNode.get(node.id) != 1 && node['authorVisible']);
    const sections = figma.currentPage.findChildren((node:any) => node.type === "SECTION")
    sections.forEach((section:any) => {
      let sticky = section.findChildren((node:any) => node.type === "STICKY" && usedNode.get(node.id) != 1 && removedNode.get(node.id) != 1 && node['authorVisible'])
      if(sticky?.length) stickies.push(...sticky)
    })
  
    console.log('mytest', curStickies)
    
    var stickyList: { name: any; stickyColor?: string; }[] = [];
    if(previousStickies.length > curStickies.length) {
      
      previousStickies.forEach((sticky:any) => {
        if(curStickies.filter(item => item.id == sticky.id)?.length > 0) {
         
        } else {
          console.log('erasedsti', sticky)
          let newSticky = {
            name: username.get(sticky.id),
          }
          stickyList.push(newSticky)
        }
      })
      if(stickyList.length > 0) {
        removeSticky(stickyList)
      }
    } else {
      stickies.forEach((sticky:any) => {
        // usedNode[sticky.id] = 1
        usedNode.set(sticky.id, 1)
        // username[sticky.id] = sticky['authorName']
        username.set(sticky.id, sticky['authorName'])
        let fill = sticky['fills'][0];
        let newSticky = {
          name: sticky['authorName'],
          stickyColor: `#${Math.floor(fill.color.r * 255).toString(16).padStart(2, '0')}${Math.floor(fill.color.g * 255).toString(16).padStart(2, '0')}${Math.floor(fill.color.b * 255).toString(16).padStart(2, '0')}`,
        }
        if(sticky['authorName'] != " ") stickyList.push(newSticky)
      })
      if(stickyList.length > 0) {
        handleSticky(stickyList);
      }
    }
    console.log('pre', previousStickies)
    console.log('cur', curStickies)
    previousStickies = [...curStickies]
    // setPreviousStickies([...curStickies])

  }
  

  const clearSticky = () => {
    previousStickies = []
    // setPreviousStickies([])
    const curStickies = figma.currentPage.findChildren((node:any) => node.type === "STICKY" && removedNode.get(node.id) != 1)
    curStickies.forEach((item:any) => {
      // removedNode[item.id] = 1
      removedNode.set(item.id, 1)
    })
    const curSections = figma.currentPage.findChildren((node:any) => node.type === "SECTION")
    curSections.forEach((section:any) => {
      let sticky = section.findChildren((node:any) => node.type === "STICKY" && removedNode.get(node.id) != 1 && node['authorVisible'])
      sticky.forEach((item:any) => {
        // removedNode[item.id] = 1
        removedNode.set(item.id, 1)
      })
    })
  }

  const moveViewPort = (name: any) => {
    figma.viewport.scrollAndZoomIntoView(figma.currentPage.findChildren((node:any) => username.get(node.id) == name && node.type === "STICKY" && node['authorVisible'])) 
  }

  const onChecked = (e: any, item: any) => {
    console.log('checked', collaborators.get('contributors'), item)
    if(e) {
      collaborators.set('reviews', [...collaborators.get('reviews'), item])
      collaborators.set('contributors', collaborators.get('contributors')?.filter((contributor: any) => contributor.id != item.id))
      // setReviews([...reviews, item])
      // setContributors(contributors.filter((contributor: any) => contributor != item))
    } else {
      collaborators.set('contributors', [...collaborators.get('contributors'), item])
      collaborators.set('reviews', collaborators.get('reviews')?.filter((review: any) => review.id != item.id))
      // setContributors([...contributors, item])
      // setReviews(reviews.filter((review: any) => review != item))
    }
  }

  const onReset = () => {
    collaborators.set('contributors', [...collaborators.get('contributors'), ...collaborators.get('reviews')])
    collaborators.set('reviews', [])
    // setContributors([...contributors, ...reviews])
    // setReviews([])
  }

  

  const shuffle = (array:any) => {
    let currentIndex = array.length,  randomIndex;
  
    // While there remain elements to shuffle.
    while (currentIndex != 0) {
  
      // Pick a remaining element.
      randomIndex = Math.floor(Math.random() * currentIndex);
      currentIndex--;
  
      // And swap it with the current element.
      [array[currentIndex], array[randomIndex]] = [
        array[randomIndex], array[currentIndex]];
    }
  
    return array;
  }

  const onRandomize = () => {
    let cons = [...collaborators.get('contributors')]
    collaborators.set('contributors', shuffle(cons))
  }

  const onClear = () => {
    clearSticky()
    collaborators.set('contributors', [])
    collaborators.set('reviews', [])
    // setContributors([])
    // setReviews([])
  }

  const handleSticky = (stickyList: any) => {
    // var finalContributors = [...contributors]
    // var finalReviews = [...reviews]
    var finalContributors = collaborators.get('contributors') || []
    var finalReviews = collaborators.get('reviews') || []
    stickyList.forEach((sticky: { name: any; stickyColor: any; }) => {
      let isContributor = false
      let isReviewer = false

      console.log('finalcon', finalContributors)
      console.log('newsticky', sticky)
      
      let newContributors = finalContributors.map((contributor: any) => {
        if(contributor.name == sticky.name) {
          isContributor = true;
          contributor.sticky += 1
        }
        return contributor
      })
      console.log('isContributor', isContributor)
      let newReviewer = finalReviews.map((review: any) => {
        if(review.name == sticky.name) {
          isReviewer = true;
          review.sticky += 1;
          return review
        }
      })
      if(isContributor) {
        finalContributors = [...newContributors]
      } else if(isReviewer) {
        finalContributors = [...finalContributors, newReviewer[0]]
        finalReviews = finalReviews.filter((review: any) => review != newReviewer[0])
      } else {
        let userId = new Date().getTime();
        console.log('why', figma.activeUsers.filter(user=> user.name == sticky.name)[0])
        let activeUser = figma.activeUsers.filter(user=> user.name == sticky.name)
        var color:any = avatarColorList[0]
        if(activeUser?.length > 0) {
          color = figma.activeUsers.filter(user=> user.name == sticky.name)[0].photoUrl
        }
         
        // avatarColorList.push(String(color));
        let newUser = {
          id: userId+sticky.name,
          avatarColor: color,
          sticky: 1, 
          name: sticky.name,
          stickyColor: sticky.stickyColor,
          opacity: 0
        }
        finalContributors = [...finalContributors, newUser]
      }
    });
    collaborators.set('contributors', finalContributors)
    collaborators.set('reviews', finalReviews)
    // setContributors(finalContributors)
    // setReviews(finalReviews)
  }

  const removeSticky = (stickyList: any) => {
    // var finalContributors = [...contributors]
    // var finalReviews = [...reviews]
    var finalContributors = collaborators.get('contributors') || []
    var finalReviews = collaborators.get('reviews') || []
    console.log('removesticky', stickyList)
    stickyList.forEach((sticky: { name: any; }) => {
      finalContributors = finalContributors.map((contributor: any) => {
        if(contributor.name == sticky.name) {
          contributor.sticky -= 1
        }
        return contributor.sticky > 0 ? contributor : null
      }).filter((el: any) => el)
      finalReviews = finalReviews.map((review: any) => {
        if(review.name == sticky.name) {
          review.sticky -= 1;
        }
        if(review.sticky > 0) return review
      })
    });
    collaborators.set('contributors', finalContributors)
    collaborators.set('reviews', finalReviews)
    // setContributors(finalContributors)
    // setReviews(finalReviews)
  }

  useEffect(() => {
    if(isFirst) {
      checkSticky()
      setFirst(false)
      // // new Promise((resolve) => {
      // //   // checkSticky()
      // //   setFirst(false)
      // // })
      // new Promise((resolve) => {
      //   setFirst(false)
      //   setInterval(()=> {
      //     checkSticky()
      //   }, 2000)
      //   figma.showUI(__html__, pluginFrameSize);
      // })
    }
  })

  return (
    <AutoLayout
      direction="vertical"
      horizontalAlignItems="start"
      verticalAlignItems="center"
      height="hug-contents"
      fill="#212121"
      spacing={12}
      effect={{
        type: 'drop-shadow',
        color: { r: 0, g: 0, b: 0, a: 0.3 },
        offset: { x: 0, y: 0 },
        blur: 2,
        spread: 2,
      }}
    >
      {!status.get('active') && (
        <AutoLayout direction="vertical" verticalAlignItems="center" horizontalAlignItems="center" height={460} width={512} padding={{top: 102, bottom: 107}}>
          <SVG
            src={companyLogo}
            width={88} 
            height={88}
          />
          <AutoLayout padding={{top: 21, bottom: 7}}>
            <Text fill="#FFA629" fontSize={32} fontWeight={600} lineHeight={39}>Facilitator</Text>
          </AutoLayout>
          <AutoLayout padding={{bottom: 40}}>
            <Text fill="#FFFFFF99" fontSize={16} fontWeight={400} lineHeight={19}>Seamless collaboration for everyone.</Text>
          </AutoLayout>
          <AutoLayout 
            direction="horizontal" 
            verticalAlignItems="center" 
            horizontalAlignItems="center" 
            height={41} 
            width={126} 
            cornerRadius={8} 
            fill="#FFA629" 
            onClick={async()=>{
              await new Promise((resolve) => {
                setInterval(checkSticky, 500)
                status.set('active', true)
                status.set('admin', figma.currentUser?.id)
                figma.showUI(__html__, pluginFrameSize);
              })
            }}>
            <Text>Begin session</Text>
          </AutoLayout>
        </AutoLayout>
      )}
      {status.get('active') && (
        <>
          {(collaborators.get('contributors')?.length === 0 || !collaborators.get('contributors')) && (collaborators.get('reviews')?.length === 0 || !collaborators.get('reviews')) && (
            <AutoLayout direction="horizontal" verticalAlignItems="center" horizontalAlignItems="center" height={450} width={512}>
              <Text fill="#FFFFFF">No contributors</Text>
            </AutoLayout>
          )}
          {collaborators.get('contributors')?.length === 0 && collaborators.get('reviews')?.length > 0 && (
            <AutoLayout direction="vertical" verticalAlignItems="center" horizontalAlignItems="center" height={148} width={512}>
              <Text fill={"#FFFFFF"} fontWeight={400} fontSize={16} lineHeight={19}>Everyone has contributed.</Text>
              <AutoLayout padding={{top: 24}}>
                <AutoLayout 
                  direction="horizontal" 
                  verticalAlignItems="center" 
                  horizontalAlignItems="center" 
                  height={43} 
                  width={179} 
                  cornerRadius={8} 
                  stroke="#FFA629" 
                  onClick={async()=>{
                    onReset();
                    if(status.get('active') && status.get('admin') == figma.currentUser?.id) {
                      await new Promise((resolve) => {
                        setInterval(checkSticky, 500)
                        figma.showUI(__html__, pluginFrameSize);
                      }) 
                    }
                  }}>
                  <Text fill={"#FFA629"} fontWeight={400} fontSize={16} lineHeight={19}>Reset Contributors</Text>
                </AutoLayout>
              </AutoLayout>
            </AutoLayout>
          )}
          {collaborators.get('contributors')?.length > 0 && (
            <>
              <AutoLayout direction="horizontal" verticalAlignItems="center" height={48} padding={{right: 20, left: 20}} spacing={236} >
                <Text fontSize={16} lineHeight={19} fontWeight={400} width={144} fill={"#FFFFFF99"}>{collaborators.get('contributors')?.length} {collaborators.get('contributors')?.length > 1? 'Contributors': 'Contributor'}</Text>
                <Text 
                  fontSize={16} 
                  lineHeight={19} 
                  fontWeight={700} 
                  fill={"#FFFFFF"}
                  onClick={async()=>{
                    onRandomize();
                    if(status.get('active') && status.get('admin') == figma.currentUser?.id) {
                      await new Promise((resolve) => {
                        setInterval(checkSticky, 500)
                        figma.showUI(__html__, pluginFrameSize);
                      }) 
                    }
                  }}>
                    Randomize
                </Text>
              </AutoLayout>
              {collaborators.get('contributors') && collaborators.get('contributors').map((contributor: {
                  opacity: number; id: any; avatarColor: any; name: any; stickyColor: any; sticky: any; 
                  }) => (
                <AutoLayout 
                  key={contributor.id} 
                  hoverStyle={{fill: "#FFFFFF1a"}} 
                  direction="horizontal" 
                  verticalAlignItems="center" 
                  padding={{right: 20, left: 20, top: 8, bottom: 8}} 
                  onClick={async ()=>{
                    if(status.get('active') && status.get('admin') == figma.currentUser?.id) {
                      await new Promise((resolve) => {
                        setInterval(checkSticky, 500)
                        figma.showUI(__html__, pluginFrameSize);
                      }) 
                    }
                  }}>
                  <AutoLayout direction="horizontal" verticalAlignItems="center" padding={{right: 45}}>
                    <AutoLayout direction="horizontal" verticalAlignItems="center" padding={{right: 16}}>
                      <Ellipse 
                        width={24} 
                        height={24} 
                        stroke="#FFA629" 
                        hoverStyle={{fill: "#FFA62910"}}
                        onClick={async (e:any) => {
                          onChecked(true, contributor);
                          if(status.get('active') && status.get('admin') == figma.currentUser?.id) {
                            await new Promise((resolve) => {
                              setInterval(checkSticky, 500)
                              figma.showUI(__html__, pluginFrameSize);
                            }) 
                          }
                        }}></Ellipse>
                    </AutoLayout>
                    <AutoLayout direction="horizontal" verticalAlignItems="center">
                      <Image
                        src={contributor.avatarColor}
                        width={48}
                        height={48}
                        cornerRadius={24}
                      />
                    </AutoLayout>
                    <AutoLayout direction="horizontal" verticalAlignItems="center" padding={{left: 16}}>
                      <Text 
                      fontSize={16} 
                      width={282} 
                      fontWeight="bold" 
                      fill={"#FFFFFF"}
                      onClick={async()=>{
                        moveViewPort(contributor.name)
                        if(status.get('active') && status.get('admin') == figma.currentUser?.id) {
                          await new Promise((resolve) => {
                            setInterval(checkSticky, 500)
                            figma.showUI(__html__, pluginFrameSize);
                          }) 
                        }
                      }}>
                        {contributor.name}
                      </Text>
                    </AutoLayout>
                  </AutoLayout>
                  <AutoLayout direction="horizontal" verticalAlignItems="center" horizontalAlignItems="center" cornerRadius={4} fill={contributor.stickyColor} width={40} height={40}>
                    <Text>{contributor.sticky}</Text>
                  </AutoLayout>
                </AutoLayout>
              ))}
            
            </>
          )}

          {collaborators.get('reviews')?.length > 0 && (
            <>
              <AutoLayout direction="horizontal" verticalAlignItems="center" height={48} padding={{right: 20, left: 20, top: 10, bottom: 10}}>
                <Text fontSize={16} lineHeight={19} fontWeight={400} width={144} fill={"#FFFFFF99"}>{collaborators.get('reviews')?.length} Reviewed</Text>
              </AutoLayout>
              {collaborators.get('reviews')?.map((review: { id: any; avatarColor: any; name: any; stickyColor: any; sticky: any; }) => (
                <AutoLayout 
                  key={review.id} 
                  direction="horizontal" 
                  verticalAlignItems="center" 
                  padding={{right: 20, left: 20, top: 8, bottom: 8}}
                  hoverStyle={{fill: "#FFFFFF1a"}} 
                  onClick={async ()=>{
                    if(status.get('active') && status.get('admin') == figma.currentUser?.id) {
                      await new Promise((resolve) => {
                        setInterval(checkSticky, 500)
                        figma.showUI(__html__, pluginFrameSize);
                      }) 
                    }
                  }}
                >
                  <AutoLayout direction="horizontal" verticalAlignItems="center" padding={{right: 45}}>
                    <AutoLayout direction="horizontal" verticalAlignItems="center" padding={{right: 16}}>
                      <SVG
                        src={iconChecked}
                        width={24} 
                        height={24}
                        onClick={async(e:any) => {
                          onChecked(false, review);
                          if(status.get('active') && status.get('admin') == figma.currentUser?.id) {
                            await new Promise((resolve) => {
                              setInterval(checkSticky, 500)
                              figma.showUI(__html__, pluginFrameSize);
                            }) 
                          }
                        }}
                      />
                    </AutoLayout>
                    <AutoLayout direction="horizontal" verticalAlignItems="center">
                      <Image
                        src={review.avatarColor}
                        width={48}
                        height={48}
                        cornerRadius={24}
                      />
                    </AutoLayout>
                    <AutoLayout direction="horizontal" verticalAlignItems="center" padding={{left: 16}}>
                      <Text fontSize={16} width={282} fontWeight="bold" fill={"#FFFFFF"}>{review.name}</Text>
                    </AutoLayout>
                  </AutoLayout>
                  <AutoLayout direction="horizontal" verticalAlignItems="center" horizontalAlignItems="center" cornerRadius={4} fill={review.stickyColor} width={40} height={40}>
                    <Text>{review.sticky}</Text>
                  </AutoLayout>
                </AutoLayout>
              ))}
            </>
          )}
          <AutoLayout direction="horizontal" verticalAlignItems="center" stroke="#00000060" height={1} width={512}></AutoLayout>
          <AutoLayout direction="horizontal" verticalAlignItems="center" spacing={32} padding={{top: 14, bottom: 22, left: 20}}>
            <Text 
              fontSize={16} 
              fontWeight="bold" 
              fill="#FFFFFF"
              onClick={async()=>{
                onReset();
                if(status.get('active') && status.get('admin') == figma.currentUser?.id) {
                  await new Promise((resolve) => {
                    setInterval(checkSticky, 500)
                    figma.showUI(__html__, pluginFrameSize);
                  }) 
                }
              }}>
              Reset
            </Text>
            <Text 
              fontSize={16} 
              fontWeight="bold" 
              fill="#FFFFFF"
              onClick={async()=>{
                onClear();
                if(status.get('active') && status.get('admin') == figma.currentUser?.id) {
                  await new Promise((resolve) => {
                    setInterval(checkSticky, 500)
                    figma.showUI(__html__, pluginFrameSize);
                  }) 
                }
              }}>
                New Session
            </Text>
          </AutoLayout>
        </>
      )}
    </AutoLayout>
  );
}
widget.register(Widget);
